# –ú—ñ–≥—Ä–∞—Ü—ñ—è applied_at

## üìã –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è

–¶–µ–π —Å–∫—Ä–∏–ø—Ç –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î `applied_at` –¥–ª—è —ñ—Å–Ω—É—é—á–∏—Ö –∫–ª—ñ—î–Ω—Ç—ñ–≤, —è–∫—ñ –≤–∂–µ —î –≤ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä—ñ, –∞–ª–µ –±—É–ª–∏ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω—ñ –¥–æ –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è `applied_at`.

## üéØ –ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏

- ‚úÖ –ü—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏ –¥–æ –≤–µ—Ä—Å—ñ—ó –∑ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—î—é
- ‚úÖ –Ø–∫—â–æ —î –∫–ª—ñ—î–Ω—Ç–∏ –≤ –±–∞–∑—ñ –±–µ–∑ `applied_at`, –∞–ª–µ –≤–æ–Ω–∏ —î –≤ –∫–ª–∞—Å—Ç–µ—Ä—ñ
- ‚úÖ –î–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó —Å—Ç–∞–Ω—É –±–∞–∑–∏ –∑ —Ñ–∞–∫—Ç–∏—á–Ω–∏–º —Å—Ç–∞–Ω–æ–º –∫–ª–∞—Å—Ç–µ—Ä–∞

## üöÄ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### 1. Dry-run —Ä–µ–∂–∏–º (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ —Å–ø–æ—á–∞—Ç–∫—É)

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ –±—É–¥–µ –∑—Ä–æ–±–ª–µ–Ω–æ –ë–ï–ó –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–º—ñ–Ω:

```bash
cd backend
python3 migrate_applied_at.py --dry-run
```

–í–∏–≤—ñ–¥ –ø–æ–∫–∞–∂–µ:
- –°–∫—ñ–ª—å–∫–∏ –∫–ª—ñ—î–Ω—Ç—ñ–≤ –±–µ–∑ `applied_at`
- –Ø–∫—ñ –∫–ª—ñ—î–Ω—Ç–∏ –±—É–¥—É—Ç—å –æ–Ω–æ–≤–ª–µ–Ω—ñ
- –°–∫—ñ–ª—å–∫–∏ –∫–ª—ñ—î–Ω—Ç—ñ–≤ –∑–∞–ª–∏—à–∏—Ç—å—Å—è –±–µ–∑ `applied_at`

### 2. –í–∏–∫–æ–Ω–∞–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ—ó

–ü—ñ—Å–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤–∏–∫–æ–Ω–∞–π—Ç–µ –º—ñ–≥—Ä–∞—Ü—ñ—é:

```bash
cd backend
python3 migrate_applied_at.py
```

–°–∫—Ä–∏–ø—Ç –∑–∞–ø–∏—Ç–∞—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è:
```
–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏? (yes/no): yes
```

## üìä –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–≤–æ–¥—É

```
============================================================
üîß –ú—ñ–≥—Ä–∞—Ü—ñ—è applied_at
============================================================
‚úèÔ∏è  –†–µ–∂–∏–º PRODUCTION (–∑–º—ñ–Ω–∏ –ë–£–î–£–¢–¨ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ)

–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏? (yes/no): yes

üìä –ó–Ω–∞–π–¥–µ–Ω–æ 72 –∫–ª—ñ—î–Ω—Ç—ñ–≤ –±–µ–∑ applied_at
üìÇ –°–∫–∞–Ω—É–≤–∞–Ω–Ω—è –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó: /path/to/k8s/prod
‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ 158 –∫–ª—ñ—î–Ω—Ç—ñ–≤ –≤ –∫–ª–∞—Å—Ç–µ—Ä—ñ

‚úèÔ∏è  –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç—ñ–≤...

  ‚úÖ [1] patient.example.com
      ‚Üí applied_at = 2025-10-13 11:04:49.704425
  ‚úÖ [2] app.example2.com
      ‚Üí applied_at = 2025-10-13 11:04:49.704425
  ...

‚úÖ –£—Å–ø—ñ—à–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–æ 72 –∫–ª—ñ—î–Ω—Ç—ñ–≤

============================================================
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
  ‚Ä¢ –í—Å—å–æ–≥–æ –∫–ª—ñ—î–Ω—Ç—ñ–≤ –±–µ–∑ applied_at: 72
  ‚Ä¢ –ó–Ω–∞–π–¥–µ–Ω–æ –≤ –∫–ª–∞—Å—Ç–µ—Ä—ñ: 72
  ‚Ä¢ –ó–∞–ª–∏—à–∏–ª–æ—Å—å –±–µ–∑ applied_at: 0
============================================================
```

## ‚öôÔ∏è –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

1. **–°–∫–∞–Ω—É–≤–∞–Ω–Ω—è –±–∞–∑–∏**: –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –≤—Å—ñ—Ö –∫–ª—ñ—î–Ω—Ç—ñ–≤ –±–µ–∑ `applied_at`
2. **–°–∫–∞–Ω—É–≤–∞–Ω–Ω—è –∫–ª–∞—Å—Ç–µ—Ä–∞**: –ß–∏—Ç–∞—î –≤—Å—ñ YAML —Ñ–∞–π–ª–∏ –∑ `PATH_K8S_PROD_DIR`
3. **–°–ø—ñ–≤—Å—Ç–∞–≤–ª–µ–Ω–Ω—è**: –ü–æ—Ä—ñ–≤–Ω—é—î –∫–ª—ñ—î–Ω—Ç—ñ–≤ –∑ –±–∞–∑–∏ –∑ YAML —Ñ–∞–π–ª–∞–º–∏ –ø–æ:
   - `domain` + `subdomain`
   - `ingress_path`
4. **–û–Ω–æ–≤–ª–µ–Ω–Ω—è**: –í—Å—Ç–∞–Ω–æ–≤–ª—é—î `applied_at` –¥–ª—è –∑–Ω–∞–π–¥–µ–Ω–∏—Ö –∫–ª—ñ—î–Ω—Ç—ñ–≤

## üîí –ë–µ–∑–ø–µ–∫–∞

- ‚úÖ –ú–∞—î `--dry-run` —Ä–µ–∂–∏–º –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
- ‚úÖ –ó–∞–ø–∏—Ç—É—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–¥ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º
- ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –ë–î (rollback –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ)
- ‚úÖ –ù–µ –∑–º—ñ–Ω—é—î —ñ–Ω—à—ñ –ø–æ–ª—è –∫–ª—ñ—î–Ω—Ç—ñ–≤

## üìù –í–∏–º–æ–≥–∏

- Python 3.7+
- –ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π `.env` —Ñ–∞–π–ª –∑ `PATH_K8S_PROD_DIR`
- –î–æ—Å—Ç—É–ø –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
- –î–æ—Å—Ç—É–ø –¥–æ YAML —Ñ–∞–π–ª—ñ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∞

## ‚ùì FAQ

**Q: –ß–∏ –º–æ–∂–Ω–∞ –∑–∞–ø—É—Å–∫–∞—Ç–∏ —Å–∫—Ä–∏–ø—Ç –∫—ñ–ª—å–∫–∞ —Ä–∞–∑—ñ–≤?**  
A: –¢–∞–∫, —Å–∫—Ä–∏–ø—Ç —ñ–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∏–π. –í—ñ–Ω –æ–Ω–æ–≤–∏—Ç—å —Ç—ñ–ª—å–∫–∏ –∫–ª—ñ—î–Ω—Ç—ñ–≤ –±–µ–∑ `applied_at`.

**Q: –©–æ —Å—Ç–∞–Ω–µ—Ç—å—Å—è –∑ –∫–ª—ñ—î–Ω—Ç–∞–º–∏, —è–∫–∏—Ö –Ω–µ–º–∞—î –≤ –∫–ª–∞—Å—Ç–µ—Ä—ñ?**  
A: –í–æ–Ω–∏ –∑–∞–ª–∏—à–∞—Ç—å—Å—è –±–µ–∑ `applied_at` (—Ü–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ - –≤–æ–Ω–∏ –Ω–µ deployed).

**Q: –ß–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑—É–ø–∏–Ω—è—Ç–∏ —Å–µ—Ä–≤—ñ—Å –ø–µ—Ä–µ–¥ –º—ñ–≥—Ä–∞—Ü—ñ—î—é?**  
A: –ù—ñ, –º—ñ–≥—Ä–∞—Ü—ñ—è –±–µ–∑–ø–µ—á–Ω–∞ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –Ω–∞ –∂–∏–≤—ñ–π —Å–∏—Å—Ç–µ–º—ñ.

**Q: –Ø–∫ —Å–∫–∞—Å—É–≤–∞—Ç–∏ –∑–º—ñ–Ω–∏?**  
A: –í–∏ –º–æ–∂–µ—Ç–µ –≤—Ä—É—á–Ω—É –æ—á–∏—Å—Ç–∏—Ç–∏ `applied_at` –≤ –±–∞–∑—ñ –∞–±–æ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ –∑ –±–µ–∫–∞–ø—É.

## üêõ –ü–æ–º–∏–ª–∫–∏

–Ø–∫—â–æ –≤–∏–Ω–∏–∫–∞—é—Ç—å –ø–æ–º–∏–ª–∫–∏:

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `.env` —Ñ–∞–π–ª
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `PATH_K8S_PROD_DIR`
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –ë–î
4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ YAML —Ñ–∞–π–ª—ñ–≤

## üìå –ü—Ä–∏–º—ñ—Ç–∫–∞

–ü—ñ—Å–ª—è —Ü—ñ—î—ó –º—ñ–≥—Ä–∞—Ü—ñ—ó –≤—Å—ñ **–Ω–æ–≤—ñ** –∫–ª—ñ—î–Ω—Ç–∏ –±—É–¥—É—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ `applied_at` –ø—Ä–∏ —ñ–º–ø–æ—Ä—Ç—ñ –∑ –∫–ª–∞—Å—Ç–µ—Ä–∞ –∑–∞–≤–¥—è–∫–∏ –æ–Ω–æ–≤–ª–µ–Ω—ñ–π —Ñ—É–Ω–∫—Ü—ñ—ó `_upsert_item()`.
